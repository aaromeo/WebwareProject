<!DOCTYPE html>
<html>
	<style>
		html, body {
			font-family: 'Muli', Sans-Serif;
			font-size: 1em;
			text-align: center;
		}

		h1 {
			font-family: 'Helvetica Neue';
			text-align: center;
			padding: 1em;

		}

		div.sidebar {
		    position:fixed;
		    width: 240px;
		    right:5px; bottom: 7px;
		}

		div.container{
			margin: 0 240px 0 auto;
		}

		#title {
			font-size: 2em;
			padding: 1em;
		}

		button {
			font-size: 1.3em;
		}

		.comment {
			text-align: left;
			padding: 0 2em;
		}

		input#comment {
			font-size: 1.2em;
		}

		#eventcontent {
			padding: .5em 0 .5em 8em;
			background: #eee;
			text-align: left;
		}

		.events {
			text-align: left;
			padding: 1em;
			margin: 1em;
			background: white;
			border-radius: 10px;
			border-bottom: 1px solid #999;
			background: #eee;
			font-family: Sans-Serif;
			line-height: 1.4;
		}
		
		#back {
			text-align: left;
		}

		h2 {
		  font-weight: bold;
		  font-size: 1.5em;
		} 
		table, th{
		    border: 1px solid black;
		    border-collapse: collapse;
		    font-size: .1em;
		    text-align: center;
		    background: white;
		    padding: 7px;
		}

		th.month{
			background: #58ACFA;
		}

		td{
			border: 1px solid black;
		    border-collapse: collapse;
		    font-size: .1em;
		    text-align: center;
		    background: white;
		    padding: 7px;
		   	font-size: .1em;
		   	width: 18px;
		   	height: 18px;

		}
	</style>

	<body>
		<div class="container">
			<h1>
				Set up events for Thailand IQP
			</h1>
			<center>
				<input type="button" name="new" value="New Post" onclick="makeGet('/getNewEvent');">
			</center>
			<div class="left">
				<div id="content">
				</div>
			</div>
		</div>
		<div class="sidebar">
			<table>
				<tr>
					<th class='month' colspan="7">December</th>
				<tr>
					<th>S</th>
					<th>M</th>
					<th>T</th>
					<th>W</th>
					<th>T</th>
					<th>F</th>
					<th>S</th>
				</tr>
				<!-- <tr>
					<td></td>
					<td></td>
					<td id="Dec1">1</td>
					<td id="Dec2">2</td>
					<td id="Dec3">3</td>
					<td id="Dec4">4</td>
					<td id="Dec5">5</td>
				</tr>
				<tr>
					<td id="Dec6">6</td>
					<td id="Dec7">7</td>
					<td id="Dec8">8</td>
					<td id="Dec9">9</td>
					<td id="Dec10">10</td>
					<td id="Dec11">11</td>
					<td id="Dec12">12</td>
				</tr>
				<tr>
					<td id="Dec13">13</td>
					<td id="Dec14">14</td>
					<td id="Dec15">15</td>
					<td id="Dec16">16</td>
					<td id="Dec17">17</td>
					<td id="Dec18">18</td>
					<td id="Dec19">19</td>
				</tr>
				<tr>
					<td id="Dec20">20</td>
					<td id="Dec21">21</td>
					<td id="Dec22">22</td>
					<td id="Dec23">23</td>
					<td id="Dec24">24</td>
					<td id="Dec25">25</td>
					<td id="Dec26">26</td> -->
				</tr>
				<tr>
					<td id="Dec27">27</td>
					<td id="Dec28">28</td>
					<td id="Dec29">29</td>
					<td id="Dec30">30</td>
					<td id="Dec31">31</td>
					<td></td>
					<td></td>
				</tr>
			</table>
			<table>
				<tr>
					<th class='month' colspan="7">January</th>
				<tr>
					<th>S</th>
					<th>M</th>
					<th>T</th>
					<th>W</th>
					<th>T</th>
					<th>F</th>
					<th>S</th>
				</tr>
				<tr>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td id="Jan1">1</td>
					<td id="Jan2">2</td>
				</tr>
				<tr>
					<td id="Jan3">3</td>
					<td id="Jan4">4</td>
					<td id="Jan5">5</td>
					<td id="Jan6">6</td>
					<td id="Jan7">7</td>
					<td id="Jan8">8</td>
					<td id="Jan9">9</td>					
				</tr>
				<tr>
					<td id="Jan10">10</td>
					<td id="Jan11">11</td>
					<td id="Jan12">12</td>
					<td id="Jan13">13</td>
					<td id="Jan14">14</td>
					<td id="Jan15">15</td>
					<td id="Jan16">16</td>
				</tr>
				<tr>
					<td id="Jan17">17</td>
					<td id="Jan18">18</td>
					<td id="Jan19">19</td>						
					<td id="Jan20">20</td>
					<td id="Jan21">21</td>
					<td id="Jan22">22</td>
					<td id="Jan23">23</td>
				</tr>
				<tr>
					<td id="Jan24">24</td>
					<td id="Jan25">25</td>
					<td id="Jan26">26</td>
					<td id="Jan27">27</td>
					<td id="Jan28">28</td>
					<td id="Jan29">29</td>
					<td id="Jan30">30</td>
				</tr>
				<tr>
					<td id="Jan31">31</td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
			</table>
			<table>
				<tr>
					<th class='month' colspan="7">February</th>
				<tr>
					<th>S</th>
					<th>M</th>
					<th>T</th>
					<th>W</th>
					<th>T</th>
					<th>F</th>
					<th>S</th>
				</tr>
				<tr>
					<td></td>
					<td id="Feb1">1</td>
					<td id="Feb2">2</td>
					<td id="Feb3">3</td>
					<td id="Feb4">4</td>
					<td id="Feb5">5</td>
					<td id="Feb6">6</td>
				</tr>
				<tr>
					<td id="Feb7">7</td>
					<td id="Feb8">8</td>
					<td id="Feb9">9</td>
					<td id="Feb10">10</td>
					<td id="Feb11">11</td>
					<td id="Feb12">12</td>
					<td id="Feb13">13</td>
				</tr>
				<tr>
					<td id="Feb14">14</td>
					<td id="Feb15">15</td>
					<td id="Feb16">16</td>
					<td id="Feb17">17</td>
					<td id="Feb18">18</td>
					<td id="Feb19">19</td>
					<td id="Feb20">20</td>
				</tr>
				<tr>
					<td id="Feb21">21</td>
					<td id="Feb22">22</td>
					<td id="Feb23">23</td>
					<td id="Feb24">24</td>
					<td id="Feb25">25</td>
					<td id="Feb26">26</td>
					<td id="Feb27">27</td>
				</tr>
				<tr>
					<td id="Feb28">28</td>
					<td id="Feb29">29</td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
			</table>
			<table>
				<tr>
					<th class='month' colspan="7">March</th>
				<tr>
					<th>S</th>
					<th>M</th>
					<th>T</th>
					<th>W</th>
					<th>T</th>
					<th>F</th>
					<th>S</th>
				</tr>
				<tr>
					<td></td>
					<td></td>
					<td id="Mar1">1</td>
					<td id="Mar2">2</td>
					<td id="Mar3">3</td>
					<td id="Mar4">4</td>
					<td id="Mar5">5</td>
				</tr>
				<tr>
					<td id="Mar6">6</td>
					<td id="Mar7">7</td>
					<td id="Mar8">8</td>
					<td id="Mar9">9</td>
					<td id="Mar10">10</td>
					<td id="Mar11">11</td>
					<td id="Mar12">12</td>
				</tr>
				<tr>
					<td id="Mar13">13</td>
					<td id="Mar14">14</td>
					<td id="Mar15">15</td>
					<td id="Mar16">16</td>
					<td id="Mar17">17</td>
					<td id="Mar18">18</td>
					<td id="Mar19">19</td>
				</tr>
				<!-- <tr>
					<td id="Mar20">20</td>
					<td id="Mar21">21</td>
					<td id="Mar22">22</td>
					<td id="Mar23">23</td>
					<td id="Mar24">24</td>
					<td id="Mar25">25</td>
					<td id="Mar26">26</td>
				</tr>
				<tr>
					<td id="Mar27">27</td>
					<td id="Mar28">28</td>
					<td id="Mar29">29</td>
					<td id="Mar30">30</td>
					<td id="Mar31">31</td>
					<td></td>
					<td></td>
				</tr> -->
			</table>
		</div>
	</body>

<script src="http://underscorejs.org/underscore-min.js"> 
</script>
<script>

var content = document.getElementById("content");
var days = 
[document.getElementById("Jan1"),
document.getElementById("Jan2"),
document.getElementById("Jan3"),
document.getElementById("Jan4"),
document.getElementById("Jan5"),
document.getElementById("Jan6"),
document.getElementById("Jan7"),
document.getElementById("Jan8"),
document.getElementById("Jan9"),
document.getElementById("Jan10"),
document.getElementById("Jan11"),
document.getElementById("Jan12"),
document.getElementById("Jan13"),
document.getElementById("Jan14"),
document.getElementById("Jan15"),
document.getElementById("Jan16"),
document.getElementById("Jan17"),
document.getElementById("Jan18"),
document.getElementById("Jan19"),
document.getElementById("Jan20"),
document.getElementById("Jan21"),
document.getElementById("Jan22"),
document.getElementById("Jan23"),
document.getElementById("Jan24"),
document.getElementById("Jan25"),
document.getElementById("Jan26"),
document.getElementById("Jan27"),
document.getElementById("Jan28"),
document.getElementById("Jan29"),
document.getElementById("Jan30"),
document.getElementById("Jan31"),
document.getElementById("Feb1"),
document.getElementById("Feb2"),
document.getElementById("Feb3"),
document.getElementById("Feb4"),
document.getElementById("Feb5"),
document.getElementById("Feb6"),
document.getElementById("Feb7"),
document.getElementById("Feb8"),
document.getElementById("Feb9"),
document.getElementById("Feb10"),
document.getElementById("Feb11"),
document.getElementById("Feb12"),
document.getElementById("Feb13"),
document.getElementById("Feb14"),
document.getElementById("Feb15"),
document.getElementById("Feb16"),
document.getElementById("Feb17"),
document.getElementById("Feb18"),
document.getElementById("Feb19"),
document.getElementById("Feb20"),
document.getElementById("Feb21"),
document.getElementById("Feb22"),
document.getElementById("Feb23"),
document.getElementById("Feb24"),
document.getElementById("Feb25"),
document.getElementById("Feb26"),
document.getElementById("Feb27"),
document.getElementById("Feb28"),
document.getElementById("Feb29"),
document.getElementById("Mar1"),
document.getElementById("Mar2"),
document.getElementById("Mar3"),
document.getElementById("Mar4"),
document.getElementById("Mar5"),
document.getElementById("Mar6"),
document.getElementById("Mar7"),
document.getElementById("Mar8"),
document.getElementById("Mar9"),
document.getElementById("Mar10"),
document.getElementById("Mar11"),
document.getElementById("Mar12"),
document.getElementById("Mar13"),
document.getElementById("Mar14"),
document.getElementById("Mar15"),
document.getElementById("Mar16"),
document.getElementById("Mar17"),
document.getElementById("Mar18"),
document.getElementById("Mar19"),
document.getElementById("Mar20"),
document.getElementById("Mar21"),
document.getElementById("Mar22"),
document.getElementById("Mar23"),
document.getElementById("Mar24"),
document.getElementById("Mar25"),
document.getElementById("Mar26"),
document.getElementById("Mar27"),
document.getElementById("Mar28"),
document.getElementById("Mar29"),
document.getElementById("Mar30"),
document.getElementById("Mar31"),
document.getElementById("Dec1"),
document.getElementById("Dec2"),
document.getElementById("Dec3"),
document.getElementById("Dec4"),
document.getElementById("Dec5"),
document.getElementById("Dec6"),
document.getElementById("Dec7"),
document.getElementById("Dec8"),
document.getElementById("Dec9"),
document.getElementById("Dec10"),
document.getElementById("Dec11"),
document.getElementById("Dec12"),
document.getElementById("Dec13"),
document.getElementById("Dec14"),
document.getElementById("Dec15"),
document.getElementById("Dec16"),
document.getElementById("Dec17"),
document.getElementById("Dec18"),
document.getElementById("Dec19"),
document.getElementById("Dec20"),
document.getElementById("Dec21"),
document.getElementById("Dec22"),
document.getElementById("Dec23"),
document.getElementById("Dec24"),
document.getElementById("Dec25"),
document.getElementById("Dec26"),
document.getElementById("Dec27"),
document.getElementById("Dec28"),
document.getElementById("Dec29"),
document.getElementById("Dec30"),
document.getElementById("Dec31"),]

var events = content.getElementsByClassName("events");

for (var i = 0; i < events.length; i++){
	events[i].addEventListener("mouseenter", highlightDate());
	events[i].addEventListener("mouseleave", unhighlightDate());
	console.log(i);
};

function setEventListeners() {
	events = content.getElementsByClassName("events");
	console.log(events.length);
	console.log(events);
	for (var i = 0; i < events.length; i++) {
		console.log(i);
		console.log(events[i]);
		var date = events[i].innerHTML.match(/Q([^"]+)Q/)[1];
		var calendarEl = document.getElementById(date);
		calendarEl.style.background = "#FE9A2E";
		events[i].removeEventListener("mouseenter", highlightDate);
		events[i].removeEventListener("mouseleave", unhighlightDate);
		events[i].addEventListener("mouseenter", highlightDate);
		events[i].addEventListener("mouseleave", unhighlightDate);
	};
}

function addLike(index){
	console.log(events[index].innerHTML);
	var likes = parseInt(events[index].innerHTML.match(/addLike(.+?)\(([^"]+?)<\/p>/)[1], 10);
	likes++;
	var req = new XMLHttpRequest();
	req.open('POST', '/incrementLikes', true);
    req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    req.send('id='+index);
    document.getElementById("like"+index).onclick = function() {
    	this.disabled = true;
    };
    document.getElementById("dislike"+index).onclick = function() {
    	this.disabled = true;
    };
	console.log(likes);

    makeGet('/events');
}

function addDislike(index){
	var dislikes = parseInt(events[index].innerHTML.match(/addDislike(.+?)\(([^"]+?)<\/p>/)[1], 10);
	dislikes++;
	var req = new XMLHttpRequest();
	req.open('POST', '/decrementLikes', true);
    req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    req.send('id='+index);
    console.log(document.getElementById("like"+index));
    document.getElementById("like"+index).onclick = function() {
    	this.disabled = true;
    };
    document.getElementById("dislike"+index).onclick = function() {
    	this.disabled = true;
    };
	console.log(dislikes);
    makeGet('/events');
}

function highlightDate(evt) {
	var date = evt.path[0].innerHTML.match(/Q([^"]+)Q/)[1];
	var calendarEl = document.getElementById(date);
	calendarEl.style.background = "#47FF6A";
}

function unhighlightDate(evt) {
	var date = evt.path[0].innerHTML.match(/Q([^"]+)Q/)[1];
	var calendarEl = document.getElementById(date);
	calendarEl.style.background = "#FE9A2E";
	console.log(evt);
}

function addEvent() {
	console.log("Clicked button!");
	var eventname = document.getElementById('eventname').value;
	var date = document.getElementById('date').value;
	var description = document.getElementById('description').value;

	var req = new XMLHttpRequest();
	req.open('POST', '/addEvent', true);
    req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

    req.send('eventname='+eventname+'&date='+idDate(date)+'&formattedDate='+changeDate(date)+'&description='+description);

    makeGet('/events');
}

function addComment(id) {
	var comment = document.getElementById("comment").value;
	document.getElementById("comment").value = "";

	var reqp = new XMLHttpRequest();
	reqp.open('POST', '/addComment', true);
	reqp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

	reqp.send('id='+id+'&comment='+comment+'&username='+'Get this from cookies');

	updateComments(id);
}

function updateComments(id) {
	makeGet('/event/'+id+'/comments', 'comments-holder');
}

function getEvent(id) {
	makeGet('/event/'+id);
	updateComments(id);
}

function changeDate(date){
  var split = date.split("-");
  var day = parseInt(split[2], 10);
  var month = parseInt(split[1], 10);
  var year = parseInt(split[0], 10);
  var months = ["", "January ", "February ", "March ", "", "", "", "", "", "", "", "", "December "];
  var days = ["","1st, ", "2nd, ", "3rd, ", "4th, ", "5th, ", "6th, ", "7th, ", "8th, ", "9th, ", "10th, ","11th, ", "12th, ", "13th, ", "14th, ", "15th, ", "16th, ", "17th, ", "18th, ", "19th, ", "20th, ", "21st, ", "22nd, ", "23rd, ", "24th, ", "25th, ", "26th, ", "27th, ", "28th, ", "29th, ", "30th, ", "31st, "]
  str = "";
  str += months[month] + days[day] + year;
  return str;
}

function idDate(date){
  str = "";
  var split = date.split("-");
  var day = parseInt(split[2], 10);
  var month = parseInt(split[1], 10);
  var months = ["", "Jan", "Feb", "Mar", "", "", "", "", "", "", "", "", "Dec"];
  var days = ["","1", "2", "3", "4", "5", "6", "7", "8", "9", "10","11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31"]
  str = months[month] + days[day]
  return str;
}

function makeGet(url, elementId) {
	if (typeof(elementId)==='undefined') elementId = 'content';
	var req = new XMLHttpRequest();

	req.onreadystatechange = function() {
 	 handleRes(req, elementId);
	}

	req.open('GET', url);
	req.send();
}

function handleRes(req, elementId) {
  if( req.readyState !== XMLHttpRequest.DONE )
    return;

  if(req.status === 200) {
  	document.getElementById(elementId).innerHTML = "";
    document.getElementById(elementId).innerHTML += req.responseText;
    setEventListeners();
	}
}

makeGet('/events');

</script>

</html>





